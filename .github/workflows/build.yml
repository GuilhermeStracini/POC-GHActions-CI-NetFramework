name: CI
on: [push,  workflow_dispatch]

jobs:
  build:
    name: Build
    runs-on: windows-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
            
      - name: Setup MSBuild Path
        uses: warrenbuckley/Setup-MSBuild@v1
        env:
          ACTIONS_ALLOW_UNSECURE_COMMANDS: true
    
      - name: Setup Nuget
        uses: NuGet/setup-nuget@v1.1.1
        env:
          ACTIONS_ALLOW_UNSECURE_COMMANDS: true
        
      - name: Restore NuGet Packages
        run: nuget restore GHActionsCI.sln       
      
      - name: Build
        run: msbuild GHActionsCI.sln /p:Configuration=Release

      - name: Run
        run: GHActionsCI.exe
      
      - name: Upload artifact
        uses: actions/upload-artifact@v3.1.2
        with:
          name: release
          path: Src\GHActionsCI\bin\Release\
          
  deploy:
    name: Deploy
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Download release
        uses: actions/download-artifact@v3
        with:
          name: release

      - name: Upload to test FTP
        uses: sebastianpopp/ftp-action@releases/v2
        with:
          host: ftp://ftp.dlptest.com/
          user: dlpuser
          password: rNrKYTX9g7z3RgJRmxWuGHbeu
